function playVideo(e){if(video=$(e).find("video").get(0),!video)return!0;0<video.currentTime&&!video.paused&&!video.ended&&2<video.readyState||video.play()}function pauseVideo(e){if(video=$(e).find("video").get(0),!video)return!0;0<video.currentTime&&!video.paused&&!video.ended&&2<video.readyState&&video.pause()}function onScroll(e){var t=$(document).scrollTop();$("#secondNav li a").each(function(){var e=$(this),o=$(e.attr("href"));o.position().top-200<=t&&o.position().top+o.height()>t?(e.not(".active")&&($("#secondNav li a").removeClass("active"),e.addClass("active"),(e.offset().left<0||e.offset().left>$(window).width()-50)&&$("#secondNav").animate({scrollLeft:e.offset().left},300)),playVideo(o)):(e.removeClass("active"),pauseVideo(o))})}$(document).ready(function(){$("#nav-icon").click(function(){$(this).toggleClass("open"),$("#sidebarNav").toggleClass("open"),$("#PageOverlay").toggleClass("open"),$("body").toggleClass("open")}),$(document).on("scroll",onScroll),$('a[href^="#"]').on("click",function(e){e.preventDefault(),$("a").each(function(){$(this).removeClass("active")}),$(this).addClass("active");var o=this.hash,t=$(o);t.length&&$("html, body").stop().animate({scrollTop:t.offset().top},500,"swing",function(){window.location.hash=o})});var o=$(window).scrollTop();if($(window).scroll(function(){var e=$(this).scrollTop();e<0&&(e=0),o<e?$(".header, body").addClass("fixed"):$(".header, body").removeClass("fixed"),o=e}),$("#ourHistory").length){var e=$("#ourHistory .owl-carousel .carousel-content").length,i=$('#ourHistory input[type="range"]'),t=$("#ourHistory .owl-carousel"),s=!1,l=50*(e-1),r=function(e){return Math.round(e/50)};t.on("changed.owl.carousel initialized.owl.carousel",function(e){if(e.item){var o=e.item.index,t=e.item.count;t<=o?o-=t:o<0&&(o+=t),console.log("scrollto",o),r(i.val())==o||s||((a=50*(n=o))<0&&(a=0),l<a&&(a=l),$({val:i.val()}).animate({val:50*n},{duration:300,easing:"linear",step:function(e){i.val(Math.ceil(e))}}))}var n,a}),t.owlCarousel({loop:!1,margin:24,responsiveClass:!0,dots:!1,startPosition:1,responsive:{0:{items:1,nav:!0},500:{items:2,nav:!0},768:{items:3,nav:!0},980:{items:4,nav:!0}}}),i.prop("min",0),i.val(100),i.prop("max",l),i.on("change input",function(e){t.trigger("to.owl.carousel",[r($(this).val()),300])}),i.on("mousedown",function(e){s=!0}),i.on("mouseup",function(e){s=!1}),setTimeout(function(){t.trigger("to.owl.carousel",[e,1])},1)}var n=function(){$(".show-modal").removeClass("show-modal"),$("body").removeClass("no-scroll")};$(".trigger").on("click",function(){return function(e){console.log("modal open ",e);var o=$("#"+e);o.length&&($("body").addClass("no-scroll"),o.addClass("show-modal"))}($(this).data("target")),!1}),$(".close-button").on("click",function(){n()}),$("body").on("click",function(e){$(e.target).is(".modal")&&n()}),$('select[name="country_id"]').length&&$.get("/countries.json").done(function(e){$('select[name="country_id"]').each(function(){var t=$(this);$.each(e,function(e,o){t.append($("<option />").val(e).text(o))})})}),$("select").on("blur",function(){$(this).attr("value",$(this).val())})}),$(document).ready(function(){$("#modalFeedback form").on("submit",function(){var t=$(this);return t.find(".field").removeClass("error-block"),$.post(window.URL_FORM_FEEDBACK,$(this).serialize()).done(function(e){$("#modalFeedback .modal-header").html(""),$("#modalFeedback .modal-content").html('<p class="finish-text">Thank you for your feedback!</p>')}).fail(function(e){e.responseJSON&&$.each(e.responseJSON,function(e,o){t.find('[name="'+e+'"]').closest(".field").addClass("error-block").find("p").text(o.join(", "))})}),!1}),$("#modalStory form").on("submit",function(){var t=$(this);return t.find(".field").removeClass("error-block"),$.post(window.URL_FORM_STORY,$(this).serialize()).done(function(e){$("#modalStory .modal-header").html(""),$("#modalStory .modal-content").html('<p class="finish-text">Тhank you, your story has been sent!</p>')}).fail(function(e){e.responseJSON&&$.each(e.responseJSON,function(e,o){t.find('[name="'+e+'"]').closest(".field").addClass("error-block").find("p").text(o.join(", "))})}),!1}),$("#modalContact form").on("submit",function(){var t=$(this);return t.find(".field").removeClass("error-block"),$.post(window.URL_FORM_CONTACT,$(this).serialize()).done(function(e){$("#modalContact .modal-header").html(""),$("#modalContact .modal-content").html('<p class="finish-text">Тhank you, your story has been sent!</p>')}).fail(function(e){e.responseJSON&&$.each(e.responseJSON,function(e,o){t.find('[name="'+e+'"]').closest(".field").addClass("error-block").find("p").text(o.join(", "))})}),!1})}),$(document).ready(function(){size_li=$(".inf_scroll .inf_wrap").length,x=10,$(".inf_scroll .inf_wrap:lt("+x+")").fadeIn(),$("#loadMore").click(function(){x=x+10<=size_li?x+10:size_li,$(".inf_scroll .inf_wrap:lt("+x+")").fadeIn(),$(this).toggle(x<size_li)});document.addEventListener("invalid",function(e){$(e.target).addClass("invalid"),$("html, body").animate({scrollTop:$($(".invalid")[0]).offset().top-150},0)},!0),document.addEventListener("change",function(e){$(e.target).removeClass("invalid")},!0)}),$(document).ready(function(){var t="Read more";$(".more").each(function(){var e=$(this).html();if(327<e.length){var o=e.substr(0,327)+'<span class="moreellipses">...&nbsp;</span><span class="morecontent"><span>'+e.substr(327,e.length-327)+'</span><a href="" class="morelink">'+t+"</a></span>";$(this).html(o)}}),$(".morelink").click(function(){return $(this).hasClass("less")?($(this).removeClass("less"),$(this).html(t)):($(this).addClass("less"),$(this).html("Hide")),$(this).parent().prev().toggle(),$(this).prev().toggle(),!1})}),$(document).ready(function(){var e,o;$(".expand_all_toggle").on("click",function(){$(this).hasClass("open")?($(".acc_content").slideUp(),$(this).removeClass("open"),$(this).text("Expand all"),$(".acc_toggle").removeClass("active")):($(this).text("Collapse all"),$(".acc_content").slideDown(),$(this).addClass("open"),$(".acc_toggle").addClass("active"))}),e=jQuery,o=e(".acc_wrapper .acc_content").hide(),e(".acc_wrapper .acc_toggle.first").next().addClass("active").slideDown(),e(".acc_wrapper .acc_toggle").click(function(){return $this=e(this),$target=$this.next(),$target.hasClass("active")?($this.removeClass("active"),$target.removeClass("active").slideUp()):(o.removeClass("active").slideUp(),$this.addClass("active"),$target.addClass("active").slideDown()),!1})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicGxheVZpZGVvIiwiaG9sZGVyIiwidmlkZW8iLCIkIiwiZmluZCIsImdldCIsImN1cnJlbnRUaW1lIiwicGF1c2VkIiwiZW5kZWQiLCJyZWFkeVN0YXRlIiwicGxheSIsInBhdXNlVmlkZW8iLCJwYXVzZSIsIm9uU2Nyb2xsIiwiZXZlbnQiLCJzY3JvbGxQb3MiLCJkb2N1bWVudCIsInNjcm9sbFRvcCIsImVhY2giLCJjdXJyTGluayIsInRoaXMiLCJyZWZFbGVtZW50IiwiYXR0ciIsInBvc2l0aW9uIiwidG9wIiwiaGVpZ2h0Iiwibm90IiwicmVtb3ZlQ2xhc3MiLCJhZGRDbGFzcyIsIm9mZnNldCIsImxlZnQiLCJ3aW5kb3ciLCJ3aWR0aCIsImFuaW1hdGUiLCJzY3JvbGxMZWZ0IiwicmVhZHkiLCJjbGljayIsInRvZ2dsZUNsYXNzIiwib24iLCJlIiwicHJldmVudERlZmF1bHQiLCJ0YXJnZXQiLCJoYXNoIiwiJHRhcmdldCIsImxlbmd0aCIsInN0b3AiLCJsb2NhdGlvbiIsImxhc3RTY3JvbGxUb3AiLCJzY3JvbGwiLCJzdCIsIm93bEl0ZW1Db3VudCIsIiRyYW5nZUlucHV0IiwiJG93bENvbnRhaW5lciIsInJhbmdlVG91Y2hlZCIsInJhbmdlTWF4IiwicmFuZ2VWYWxUb0luZGV4IiwiaW5wdXQiLCJNYXRoIiwicm91bmQiLCJpdGVtIiwiaW5kZXgiLCJjb3VudCIsImNvbnNvbGUiLCJsb2ciLCJ2YWwiLCJ0byIsImR1cmF0aW9uIiwiZWFzaW5nIiwic3RlcCIsImNlaWwiLCJvd2xDYXJvdXNlbCIsImxvb3AiLCJtYXJnaW4iLCJyZXNwb25zaXZlQ2xhc3MiLCJkb3RzIiwic3RhcnRQb3NpdGlvbiIsInJlc3BvbnNpdmUiLCIwIiwiaXRlbXMiLCJuYXYiLCI1MDAiLCI3NjgiLCI5ODAiLCJwcm9wIiwidHJpZ2dlciIsInNldFRpbWVvdXQiLCJtb2RhbENsb3NlQWxsIiwiaWQiLCIkbW9kYWwiLCJtb2RhbE9wZW4iLCJkYXRhIiwiaXMiLCJkb25lIiwicmVzdWx0IiwiJHRoaXMiLCJrZXkiLCJ2YWx1ZSIsImFwcGVuZCIsInRleHQiLCIkZm9ybSIsInBvc3QiLCJVUkxfRk9STV9GRUVEQkFDSyIsInNlcmlhbGl6ZSIsImh0bWwiLCJmYWlsIiwicmVzcG9uc2VKU09OIiwiY2xvc2VzdCIsImpvaW4iLCJVUkxfRk9STV9TVE9SWSIsIlVSTF9GT1JNX0NPTlRBQ1QiLCJzaXplX2xpIiwieCIsImZhZGVJbiIsInRvZ2dsZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJtb3JldGV4dCIsImNvbnRlbnQiLCJzdWJzdHIiLCJoYXNDbGFzcyIsInBhcmVudCIsInByZXYiLCJhbGxQYW5lbHMiLCJzbGlkZVVwIiwic2xpZGVEb3duIiwialF1ZXJ5IiwiaGlkZSIsIm5leHQiXSwibWFwcGluZ3MiOiJBQW1MQSxTQUFTQSxVQUFVQyxHQUVqQixHQURBQyxNQUFRQyxFQUFFRixHQUFRRyxLQUFLLFNBQVNDLElBQUksSUFDL0JILE1BQ0gsT0FBTyxFQUUyQixFQUFwQkEsTUFBTUksY0FBb0JKLE1BQU1LLFNBQVdMLE1BQU1NLE9BQTRCLEVBQW5CTixNQUFNTyxZQUU5RVAsTUFBTVEsT0FJVixTQUFTQyxXQUFXVixHQUVsQixHQURBQyxNQUFRQyxFQUFFRixHQUFRRyxLQUFLLFNBQVNDLElBQUksSUFDL0JILE1BQ0gsT0FBTyxFQUMyQixFQUFwQkEsTUFBTUksY0FBb0JKLE1BQU1LLFNBQVdMLE1BQU1NLE9BQTRCLEVBQW5CTixNQUFNTyxZQUU5RVAsTUFBTVUsUUFJVixTQUFTQyxTQUFTQyxHQUNoQixJQUFJQyxFQUFZWixFQUFFYSxVQUFVQyxZQUM1QmQsRUFBRSxtQkFBbUJlLEtBQUssV0FDeEIsSUFBSUMsRUFBV2hCLEVBQUVpQixNQUNiQyxFQUFhbEIsRUFBRWdCLEVBQVNHLEtBQUssU0FFN0JELEVBQVdFLFdBQVdDLElBQUksS0FBT1QsR0FBYU0sRUFBV0UsV0FBV0MsSUFBTUgsRUFBV0ksU0FBV1YsR0FDOUZJLEVBQVNPLElBQUks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Y3Rpb24gKCkge1xyXG4gICQoJyNuYXYtaWNvbicpLmNsaWNrKGZ1bmN0aW9uKCl7XHJcbiAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdvcGVuJyk7XHJcbiAgICAkKCcjc2lkZWJhck5hdicpLnRvZ2dsZUNsYXNzKCdvcGVuJyk7XHJcbiAgICAkKCcjUGFnZU92ZXJsYXknKS50b2dnbGVDbGFzcygnb3BlbicpO1xyXG4gICAgJCgnYm9keScpLnRvZ2dsZUNsYXNzKCdvcGVuJyk7XHJcbiAgfSk7XHJcbiAgJChkb2N1bWVudCkub24oJ3Njcm9sbCcsIG9uU2Nyb2xsKTtcclxuXHJcbiAgJCgnYVtocmVmXj1cIiNcIl0nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4vLyAgJChkb2N1bWVudCkub2ZmKCdzY3JvbGwnKTtcclxuXHJcbiAgICAkKCdhJykuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgfSk7XHJcbiAgICAkKHRoaXMpLmFkZENsYXNzKCdhY3RpdmUnKTtcclxuXHJcbiAgICB2YXIgdGFyZ2V0ID0gdGhpcy5oYXNoLFxyXG4gICAgJHRhcmdldCA9ICQodGFyZ2V0KTtcclxuICAgIGlmICgkdGFyZ2V0Lmxlbmd0aCkge1xyXG4gICAgICAkKCdodG1sLCBib2R5Jykuc3RvcCgpLmFuaW1hdGUoe1xyXG4gICAgICAgICdzY3JvbGxUb3AnOiAkdGFyZ2V0Lm9mZnNldCgpLnRvcFxyXG4gICAgICB9LCA1MDAsICdzd2luZycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB3aW5kb3cubG9jYXRpb24uaGFzaCA9IHRhcmdldDtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gIH0pO1xyXG5cclxuICB2YXIgbGFzdFNjcm9sbFRvcCA9ICQod2luZG93KS5zY3JvbGxUb3AoKTtcclxuXHJcbiAgJCh3aW5kb3cpLnNjcm9sbChmdW5jdGlvbigpe1xyXG4gICAgdmFyIHN0ID0gJCh0aGlzKS5zY3JvbGxUb3AoKTtcclxuICAgIGlmIChzdCA8IDApXHJcbiAgICAgIHN0ID0gMDtcclxuLy8gICAgaWYgKHN0ID4gbWF4U2Nyb2xsVG9wKSAvLyAkKGRvY3VtZW50KS5oZWlnaHQoKVxyXG4vLyAgICAgIHN0ID0gbWF4U2Nyb2xsVG9wO1xyXG4gICAgaWYgKHN0ID4gbGFzdFNjcm9sbFRvcCl7XHJcbiAgICAgICQoJy5oZWFkZXIsIGJvZHknKS5hZGRDbGFzcygnZml4ZWQnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICQoJy5oZWFkZXIsIGJvZHknKS5yZW1vdmVDbGFzcygnZml4ZWQnKTtcclxuICAgIH1cclxuICAgIGxhc3RTY3JvbGxUb3AgPSBzdDtcclxuICB9KTtcclxuXHJcbiAgaWYgKCQoJyNvdXJIaXN0b3J5JykubGVuZ3RoKSB7XHJcbiAgICB2YXIgb3dsSXRlbUNvdW50ID0gJCgnI291ckhpc3RvcnkgLm93bC1jYXJvdXNlbCAuY2Fyb3VzZWwtY29udGVudCcpLmxlbmd0aDtcclxuICAgIHZhciAkcmFuZ2VJbnB1dCA9ICQoJyNvdXJIaXN0b3J5IGlucHV0W3R5cGU9XCJyYW5nZVwiXScpO1xyXG4gICAgdmFyICRvd2xDb250YWluZXIgPSAkKCcjb3VySGlzdG9yeSAub3dsLWNhcm91c2VsJyk7XHJcbiAgICB2YXIgcmFuZ2VDb2VmID0gNTA7XHJcbiAgICB2YXIgcmFuZ2VUb3VjaGVkID0gZmFsc2U7XHJcbiAgICB2YXIgcmFuZ2VNYXggPSAob3dsSXRlbUNvdW50LTEpKnJhbmdlQ29lZjtcclxuICAgIHZhciByYW5nZU1pbiA9IDA7Ly8xKnJhbmdlQ29lZjtcclxuICAgIHZhciByYW5nZVZhbFRvSW5kZXggPSBmdW5jdGlvbihpbnB1dCkge1xyXG4gICAgICByZXR1cm4gTWF0aC5yb3VuZChpbnB1dCAvIHJhbmdlQ29lZik7XHJcbiAgICB9XHJcbiAgICB2YXIgcmFuZ2VTY3JvbGxUbyA9IGZ1bmN0aW9uKGluZGV4KSB7XHJcbiAgICAgIHZhciB0byA9IGluZGV4KnJhbmdlQ29lZjtcclxuICAgICAgaWYgKHRvIDwgcmFuZ2VNaW4pXHJcbiAgICAgICAgdG8gPSByYW5nZU1pbjtcclxuICAgICAgaWYgKHRvID4gcmFuZ2VNYXgpXHJcbiAgICAgICAgdG8gPSByYW5nZU1heDtcclxuICAgICAgJCh7IHZhbDogJHJhbmdlSW5wdXQudmFsKCkgfSkuYW5pbWF0ZSh7IHZhbDogaW5kZXgqcmFuZ2VDb2VmIH0sIHtcclxuICAgICAgICAgIGR1cmF0aW9uOiAzMDAsXHJcbiAgICAgICAgICBlYXNpbmc6ICdsaW5lYXInLFxyXG4gICAgICAgICAgc3RlcDogZnVuY3Rpb24odmFsKSB7XHJcbiAgICAgICAgICAgICRyYW5nZUlucHV0LnZhbChNYXRoLmNlaWwodmFsKSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgICRvd2xDb250YWluZXIub24oJ2NoYW5nZWQub3dsLmNhcm91c2VsIGluaXRpYWxpemVkLm93bC5jYXJvdXNlbCcsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgaWYgKGUuaXRlbSkge1xyXG4gICAgICAgICAgdmFyIGluZGV4ID0gZS5pdGVtLmluZGV4O1xyXG4gICAgICAgICAgdmFyIGNvdW50ID0gZS5pdGVtLmNvdW50O1xyXG4gICAgICAgICAgaWYgKGluZGV4ID49IGNvdW50KSB7XHJcbiAgICAgICAgICAgICAgaW5kZXggPSBpbmRleCAtIGNvdW50O1xyXG4gICAgICAgICAgfSBlbHNlIGlmIChpbmRleCA8IDApIHtcclxuICAgICAgICAgICAgICBpbmRleCA9IGluZGV4ICsgY291bnQ7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnc2Nyb2xsdG8nLCBpbmRleCk7XHJcbiAgICAgICAgICBpZiAoKHJhbmdlVmFsVG9JbmRleCgkcmFuZ2VJbnB1dC52YWwoKSkgIT0gaW5kZXgpICYmICghcmFuZ2VUb3VjaGVkKSl7XHJcbiAgICAgICAgICAgIHJhbmdlU2Nyb2xsVG8oaW5kZXgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAkb3dsQ29udGFpbmVyLm93bENhcm91c2VsKHtcclxuICAgICAgICBsb29wOmZhbHNlLFxyXG4gICAgICAgIG1hcmdpbjoyNCxcclxuICAgICAgICByZXNwb25zaXZlQ2xhc3M6dHJ1ZSxcclxuICAgICAgICBkb3RzOmZhbHNlLFxyXG4vLyAgICAgICAgY2VudGVyOiB0cnVlLFxyXG4gICAgICAgIHN0YXJ0UG9zaXRpb246IDEsXHJcbiAgICAgICAgcmVzcG9uc2l2ZTp7XHJcbiAgICAgICAgICAwOntcclxuICAgICAgICAgICAgaXRlbXM6MSxcclxuICAgICAgICAgICAgbmF2OnRydWVcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICA1MDA6e1xyXG4gICAgICAgICAgICBpdGVtczoyLFxyXG4gICAgICAgICAgICBuYXY6dHJ1ZVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIDc2ODp7XHJcbiAgICAgICAgICAgIGl0ZW1zOjMsXHJcbiAgICAgICAgICAgIG5hdjp0cnVlXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgOTgwOntcclxuICAgICAgICAgICAgaXRlbXM6NCxcclxuICAgICAgICAgICAgbmF2OnRydWVcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICRyYW5nZUlucHV0LnByb3AoJ21pbicsIHJhbmdlTWluKTtcclxuICAgICRyYW5nZUlucHV0LnZhbCgyKnJhbmdlQ29lZik7XHJcbiAgICAkcmFuZ2VJbnB1dC5wcm9wKCdtYXgnLCByYW5nZU1heCk7XHJcblxyXG4gICAgJHJhbmdlSW5wdXQub24oJ2NoYW5nZSBpbnB1dCcsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgJG93bENvbnRhaW5lci50cmlnZ2VyKCd0by5vd2wuY2Fyb3VzZWwnLCBbcmFuZ2VWYWxUb0luZGV4KCQodGhpcykudmFsKCkpLCAzMDAgXSk7XHJcbiAgICB9KTtcclxuICAgICRyYW5nZUlucHV0Lm9uKCdtb3VzZWRvd24nLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgIHJhbmdlVG91Y2hlZCA9IHRydWU7XHJcbiAgICB9KTtcclxuICAgICRyYW5nZUlucHV0Lm9uKCdtb3VzZXVwJywgZnVuY3Rpb24oZSkge1xyXG4gICAgICByYW5nZVRvdWNoZWQgPSBmYWxzZTtcclxuICAgIH0pO1xyXG5cclxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICRvd2xDb250YWluZXIudHJpZ2dlcigndG8ub3dsLmNhcm91c2VsJywgW293bEl0ZW1Db3VudCwgMSBdKTtcclxuICAgIH0sIDEpO1xyXG5cclxuICB9XHJcblxyXG5cclxuICB2YXIgbW9kYWxDbG9zZUFsbCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgJCgnLnNob3ctbW9kYWwnKS5yZW1vdmVDbGFzcygnc2hvdy1tb2RhbCcpO1xyXG4gICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKCduby1zY3JvbGwnKTtcclxuICB9XHJcblxyXG4gIHZhciBtb2RhbE9wZW4gPSBmdW5jdGlvbihpZCkge1xyXG4gICAgY29uc29sZS5sb2coJ21vZGFsIG9wZW4gJywgaWQpO1xyXG4gICAgdmFyICRtb2RhbCA9ICQoJyMnICsgaWQpO1xyXG4gICAgaWYgKCRtb2RhbC5sZW5ndGgpIHtcclxuICAgICAgJCgnYm9keScpLmFkZENsYXNzKCduby1zY3JvbGwnKTtcclxuICAgICAgJG1vZGFsLmFkZENsYXNzKCdzaG93LW1vZGFsJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAkKCcudHJpZ2dlcicpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xyXG4gICAgbW9kYWxPcGVuKCQodGhpcykuZGF0YSgndGFyZ2V0JykpO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH0pO1xyXG5cclxuICAkKCcuY2xvc2UtYnV0dG9uJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XHJcbiAgICBtb2RhbENsb3NlQWxsKCk7XHJcbiAgfSk7XHJcbiAgJCgnYm9keScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcclxuICAgIGlmICgkKGUudGFyZ2V0KS5pcygnLm1vZGFsJykpIHtcclxuICAgICAgbW9kYWxDbG9zZUFsbCgpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICBpZiAoJCgnc2VsZWN0W25hbWU9XCJjb3VudHJ5X2lkXCJdJykubGVuZ3RoKSB7XHJcbiAgICAkLmdldCgnL2NvdW50cmllcy5qc29uJykuZG9uZShmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgJCgnc2VsZWN0W25hbWU9XCJjb3VudHJ5X2lkXCJdJykuZWFjaChmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpO1xyXG4gICAgICAgICQuZWFjaChyZXN1bHQsIGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcclxuICAgICAgICAgICR0aGlzLmFwcGVuZCgkKFwiPG9wdGlvbiAvPlwiKS52YWwoa2V5KS50ZXh0KHZhbHVlKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gICQoJ3NlbGVjdCcpLm9uKCdibHVyJywgZnVuY3Rpb24oKSB7XHJcbiAgICAkKHRoaXMpLmF0dHIoJ3ZhbHVlJywgJCh0aGlzKS52YWwoKSk7XHJcbiAgfSk7XHJcbiB9KTtcclxuXHJcbmZ1bmN0aW9uIHBsYXlWaWRlbyhob2xkZXIpIHtcclxuICB2aWRlbyA9ICQoaG9sZGVyKS5maW5kKCd2aWRlbycpLmdldCgwKTtcclxuICBpZiAoIXZpZGVvKVxyXG4gICAgcmV0dXJuIHRydWU7XHJcblxyXG4gIHZhciBpc1BsYXlpbmcgPSB2aWRlby5jdXJyZW50VGltZSA+IDAgJiYgIXZpZGVvLnBhdXNlZCAmJiAhdmlkZW8uZW5kZWQgJiYgdmlkZW8ucmVhZHlTdGF0ZSA+IDI7XHJcbiAgaWYgKCFpc1BsYXlpbmcpIHtcclxuICAgIHZpZGVvLnBsYXkoKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHBhdXNlVmlkZW8oaG9sZGVyKSB7XHJcbiAgdmlkZW8gPSAkKGhvbGRlcikuZmluZCgndmlkZW8nKS5nZXQoMCk7XHJcbiAgaWYgKCF2aWRlbylcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIHZhciBpc1BsYXlpbmcgPSB2aWRlby5jdXJyZW50VGltZSA+IDAgJiYgIXZpZGVvLnBhdXNlZCAmJiAhdmlkZW8uZW5kZWQgJiYgdmlkZW8ucmVhZHlTdGF0ZSA+IDI7XHJcbiAgaWYgKGlzUGxheWluZykge1xyXG4gICAgdmlkZW8ucGF1c2UoKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG9uU2Nyb2xsKGV2ZW50KSB7XHJcbiAgdmFyIHNjcm9sbFBvcyA9ICQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpO1xyXG4gICQoJyNzZWNvbmROYXYgbGkgYScpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGN1cnJMaW5rID0gJCh0aGlzKTtcclxuICAgIHZhciByZWZFbGVtZW50ID0gJChjdXJyTGluay5hdHRyKCdocmVmJykpO1xyXG4gICAgdmFyIHZpZGVvID0gbnVsbDtcclxuICAgIGlmIChyZWZFbGVtZW50LnBvc2l0aW9uKCkudG9wLTIwMCA8PSBzY3JvbGxQb3MgJiYgcmVmRWxlbWVudC5wb3NpdGlvbigpLnRvcCArIHJlZkVsZW1lbnQuaGVpZ2h0KCkgPiBzY3JvbGxQb3MpIHtcclxuICAgICAgaWYgKGN1cnJMaW5rLm5vdCgnLmFjdGl2ZScpKSB7XHJcbiAgICAgICAgJCgnI3NlY29uZE5hdiBsaSBhJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgIGN1cnJMaW5rLmFkZENsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICBpZiAoKGN1cnJMaW5rLm9mZnNldCgpLmxlZnQgPCAwKSB8fCAoY3Vyckxpbmsub2Zmc2V0KCkubGVmdCA+ICgkKHdpbmRvdykud2lkdGgoKSAtIDUwKSApKVxyXG4gICAgICAgICAgJCgnI3NlY29uZE5hdicpLmFuaW1hdGUoIHsgc2Nyb2xsTGVmdCA6IGN1cnJMaW5rLm9mZnNldCgpLmxlZnQgfSwgMzAwICk7XHJcbiAgICAgIH1cclxuICAgICAgcGxheVZpZGVvKHJlZkVsZW1lbnQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY3VyckxpbmsucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICBwYXVzZVZpZGVvKHJlZkVsZW1lbnQpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG5cclxuLypmb3JtcyovXHJcbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xyXG4gICQoJyNtb2RhbEZlZWRiYWNrIGZvcm0nKS5vbignc3VibWl0JywgZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgJGZvcm0gPSAkKHRoaXMpO1xyXG4gICAgJGZvcm0uZmluZCgnLmZpZWxkJykucmVtb3ZlQ2xhc3MoJ2Vycm9yLWJsb2NrJyk7XHJcbiAgICAkLnBvc3Qod2luZG93LlVSTF9GT1JNX0ZFRURCQUNLLCAkKHRoaXMpLnNlcmlhbGl6ZSgpKS5kb25lKGZ1bmN0aW9uKGRvbmUpIHtcclxuICAgICAgICAkKCcjbW9kYWxGZWVkYmFjayAubW9kYWwtaGVhZGVyJykuaHRtbCgnJyk7XHJcbiAgICAgICAgJCgnI21vZGFsRmVlZGJhY2sgLm1vZGFsLWNvbnRlbnQnKS5odG1sKCc8cCBjbGFzcz1cImZpbmlzaC10ZXh0XCI+VGhhbmsgeW91IGZvciB5b3VyIGZlZWRiYWNrITwvcD4nKTtcclxuICAgIH0pLmZhaWwoZnVuY3Rpb24oZmFpbCkge1xyXG4gICAgICBpZiAoZmFpbC5yZXNwb25zZUpTT04pIHtcclxuICAgICAgICAkLmVhY2goZmFpbC5yZXNwb25zZUpTT04sIGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcclxuICAgICAgICAgICRmb3JtLmZpbmQoJ1tuYW1lPVwiJytrZXkrJ1wiXScpLmNsb3Nlc3QoJy5maWVsZCcpLmFkZENsYXNzKCdlcnJvci1ibG9jaycpLmZpbmQoJ3AnKS50ZXh0KHZhbHVlLmpvaW4oJywgJykpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9KTtcclxuICAkKCcjbW9kYWxTdG9yeSBmb3JtJykub24oJ3N1Ym1pdCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyICRmb3JtID0gJCh0aGlzKTtcclxuICAgICRmb3JtLmZpbmQoJy5maWVsZCcpLnJlbW92ZUNsYXNzKCdlcnJvci1ibG9jaycpO1xyXG4gICAgJC5wb3N0KHdpbmRvdy5VUkxfRk9STV9TVE9SWSwgJCh0aGlzKS5zZXJpYWxpemUoKSkuZG9uZShmdW5jdGlvbihkb25lKSB7XHJcbiAgICAgICAgJCgnI21vZGFsU3RvcnkgLm1vZGFsLWhlYWRlcicpLmh0bWwoJycpO1xyXG4gICAgICAgICQoJyNtb2RhbFN0b3J5IC5tb2RhbC1jb250ZW50JykuaHRtbCgnPHAgY2xhc3M9XCJmaW5pc2gtdGV4dFwiPtCiaGFuayB5b3UsIHlvdXIgc3RvcnkgaGFzIGJlZW4gc2VudCE8L3A+Jyk7XHJcbiAgICB9KS5mYWlsKGZ1bmN0aW9uKGZhaWwpIHtcclxuICAgICAgaWYgKGZhaWwucmVzcG9uc2VKU09OKSB7XHJcbiAgICAgICAgJC5lYWNoKGZhaWwucmVzcG9uc2VKU09OLCBmdW5jdGlvbihrZXksIHZhbHVlKSB7XHJcbiAgICAgICAgICAkZm9ybS5maW5kKCdbbmFtZT1cIicra2V5KydcIl0nKS5jbG9zZXN0KCcuZmllbGQnKS5hZGRDbGFzcygnZXJyb3ItYmxvY2snKS5maW5kKCdwJykudGV4dCh2YWx1ZS5qb2luKCcsICcpKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfSk7XHJcbiAgJCgnI21vZGFsQ29udGFjdCBmb3JtJykub24oJ3N1Ym1pdCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyICRmb3JtID0gJCh0aGlzKTtcclxuICAgICRmb3JtLmZpbmQoJy5maWVsZCcpLnJlbW92ZUNsYXNzKCdlcnJvci1ibG9jaycpO1xyXG4gICAgJC5wb3N0KHdpbmRvdy5VUkxfRk9STV9DT05UQUNULCAkKHRoaXMpLnNlcmlhbGl6ZSgpKS5kb25lKGZ1bmN0aW9uKGRvbmUpIHtcclxuICAgICAgICAkKCcjbW9kYWxDb250YWN0IC5tb2RhbC1oZWFkZXInKS5odG1sKCcnKTtcclxuICAgICAgICAkKCcjbW9kYWxDb250YWN0IC5tb2RhbC1jb250ZW50JykuaHRtbCgnPHAgY2xhc3M9XCJmaW5pc2gtdGV4dFwiPtCiaGFuayB5b3UsIHlvdXIgc3RvcnkgaGFzIGJlZW4gc2VudCE8L3A+Jyk7XHJcbiAgICB9KS5mYWlsKGZ1bmN0aW9uKGZhaWwpIHtcclxuICAgICAgaWYgKGZhaWwucmVzcG9uc2VKU09OKSB7XHJcbiAgICAgICAgJC5lYWNoKGZhaWwucmVzcG9uc2VKU09OLCBmdW5jdGlvbihrZXksIHZhbHVlKSB7XHJcbiAgICAgICAgICAkZm9ybS5maW5kKCdbbmFtZT1cIicra2V5KydcIl0nKS5jbG9zZXN0KCcuZmllbGQnKS5hZGRDbGFzcygnZXJyb3ItYmxvY2snKS5maW5kKCdwJykudGV4dCh2YWx1ZS5qb2luKCcsICcpKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfSk7XHJcbn0pO1xyXG5cclxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xyXG4gIHNpemVfbGkgPSAkKFwiLmluZl9zY3JvbGwgLmluZl93cmFwXCIpLmxlbmd0aDtcclxuICB4ID0gMTA7XHJcbiAgJCgnLmluZl9zY3JvbGwgLmluZl93cmFwOmx0KCcgKyB4ICsgJyknKS5mYWRlSW4oKTtcclxuICAkKCcjbG9hZE1vcmUnKS5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICB4ID0gKHggKyAxMCA8PSBzaXplX2xpKSA/IHggKyAxMCA6IHNpemVfbGk7XHJcbiAgICAkKCcuaW5mX3Njcm9sbCAuaW5mX3dyYXA6bHQoJyArIHggKyAnKScpLmZhZGVJbigpO1xyXG4gICAgJCh0aGlzKS50b2dnbGUoeCA8IHNpemVfbGkpO1xyXG4gIH0pO1xyXG5cclxuICB2YXIgZGVsYXkgPSAwO1xyXG4gIHZhciBvZmZzZXQgPSAxNTA7XHJcblxyXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2ludmFsaWQnLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgJChlLnRhcmdldCkuYWRkQ2xhc3MoXCJpbnZhbGlkXCIpO1xyXG4gICAgJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoeyBzY3JvbGxUb3A6ICQoJChcIi5pbnZhbGlkXCIpWzBdKS5vZmZzZXQoKS50b3AgLSBvZmZzZXQgfSwgZGVsYXkpO1xyXG4gIH0sIHRydWUpO1xyXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAkKGUudGFyZ2V0KS5yZW1vdmVDbGFzcyhcImludmFsaWRcIilcclxuICB9LCB0cnVlKTtcclxufSk7XHJcblxyXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcclxuICAgIC8vIENvbmZpZ3VyZS9jdXN0b21pemUgdGhlc2UgdmFyaWFibGVzLlxyXG4gICAgdmFyIHNob3dDaGFyID0gMzI3OyAgLy8gSG93IG1hbnkgY2hhcmFjdGVycyBhcmUgc2hvd24gYnkgZGVmYXVsdFxyXG4gICAgdmFyIGVsbGlwc2VzdGV4dCA9IFwiLi4uXCI7XHJcbiAgICB2YXIgbW9yZXRleHQgPSBcIlJlYWQgbW9yZVwiO1xyXG4gICAgdmFyIGxlc3N0ZXh0ID0gXCJIaWRlXCI7XHJcbiAgICBcclxuICAgICQoJy5tb3JlJykuZWFjaChmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgY29udGVudCA9ICQodGhpcykuaHRtbCgpO1xyXG4gICAgICAgIGlmKGNvbnRlbnQubGVuZ3RoID4gc2hvd0NoYXIpIHtcclxuICAgICAgICAgICAgdmFyIGMgPSBjb250ZW50LnN1YnN0cigwLCBzaG93Q2hhcik7XHJcbiAgICAgICAgICAgIHZhciBoID0gY29udGVudC5zdWJzdHIoc2hvd0NoYXIsIGNvbnRlbnQubGVuZ3RoIC0gc2hvd0NoYXIpO1xyXG4gXHJcbiAgICAgICAgICAgIHZhciBodG1sID0gYyArICc8c3BhbiBjbGFzcz1cIm1vcmVlbGxpcHNlc1wiPicgKyBlbGxpcHNlc3RleHQrICcmbmJzcDs8L3NwYW4+PHNwYW4gY2xhc3M9XCJtb3JlY29udGVudFwiPjxzcGFuPicgKyBoICsgJzwvc3Bhbj48YSBocmVmPVwiXCIgY2xhc3M9XCJtb3JlbGlua1wiPicgKyBtb3JldGV4dCArICc8L2E+PC9zcGFuPic7XHJcbiAgICAgICAgICAgICQodGhpcykuaHRtbChodG1sKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuIFxyXG4gICAgJChcIi5tb3JlbGlua1wiKS5jbGljayhmdW5jdGlvbigpe1xyXG4gICAgICAgIGlmKCQodGhpcykuaGFzQ2xhc3MoXCJsZXNzXCIpKSB7XHJcbiAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoXCJsZXNzXCIpO1xyXG4gICAgICAgICAgICAkKHRoaXMpLmh0bWwobW9yZXRleHQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoXCJsZXNzXCIpO1xyXG4gICAgICAgICAgICAkKHRoaXMpLmh0bWwobGVzc3RleHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnByZXYoKS50b2dnbGUoKTtcclxuICAgICAgICAkKHRoaXMpLnByZXYoKS50b2dnbGUoKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcclxuICAkKCcuZXhwYW5kX2FsbF90b2dnbGUnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcclxuICAgIGlmICgkKHRoaXMpLmhhc0NsYXNzKCdvcGVuJykpIHtcclxuICAgICAgJCgnLmFjY19jb250ZW50Jykuc2xpZGVVcCgpO1xyXG4gICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdvcGVuJyk7XHJcbiAgICAgICQodGhpcykudGV4dCgnRXhwYW5kIGFsbCcpO1xyXG4gICAgICAkKCcuYWNjX3RvZ2dsZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgIH1lbHNle1xyXG4gICAgICAkKHRoaXMpLnRleHQoJ0NvbGxhcHNlIGFsbCcpO1xyXG4gICAgICAkKCcuYWNjX2NvbnRlbnQnKS5zbGlkZURvd24oKTtcclxuICAgICAgJCh0aGlzKS5hZGRDbGFzcygnb3BlbicpO1xyXG4gICAgICAkKCcuYWNjX3RvZ2dsZScpLmFkZENsYXNzKCdhY3RpdmUnKTtcclxuICAgIH1cclxuICB9KTtcclxuICAoZnVuY3Rpb24oJCkge1xyXG4gICAgICB2YXIgYWxsUGFuZWxzID0gJCgnLmFjY193cmFwcGVyIC5hY2NfY29udGVudCcpLmhpZGUoKTtcclxuICAgICAgJCgnLmFjY193cmFwcGVyIC5hY2NfdG9nZ2xlLmZpcnN0JykubmV4dCgpLmFkZENsYXNzKCdhY3RpdmUnKS5zbGlkZURvd24oKTtcclxuICAgICAgJCgnLmFjY193cmFwcGVyIC5hY2NfdG9nZ2xlJykuY2xpY2soZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAkdGhpcyA9ICQodGhpcyk7XHJcbiAgICAgICAgICAkdGFyZ2V0ID0gJHRoaXMubmV4dCgpO1xyXG4gICAgICAgICAgaWYgKCR0YXJnZXQuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7XHJcbiAgICAgICAgICAgICAgJHRoaXMucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICR0YXJnZXQucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpLnNsaWRlVXAoKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgYWxsUGFuZWxzLnJlbW92ZUNsYXNzKCdhY3RpdmUnKS5zbGlkZVVwKCk7XHJcbiAgICAgICAgICAgICAgJHRoaXMuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICR0YXJnZXQuYWRkQ2xhc3MoJ2FjdGl2ZScpLnNsaWRlRG93bigpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9KTtcclxuICB9KShqUXVlcnkpO1xyXG59KTsiXX0=
